@using PluginBuilder.DataModels
@model PluginEditViewModel
@{
	Layout = "_Layout";
	ViewData.SetActivePage(AdminNavPages.Plugins, "Edit Plugin");
}

<div class="d-flex align-items-center justify-content-between mb-4">
	<h2 class="mb-0">
        @ViewData["Title"] â€“ <span class="text-dark">@Model.Slug</span>
	</h2>
</div>

<nav id="SectionNav" class="mb-3">
	<div class="nav">
		<a class="nav-link active" id="edit-tab" data-bs-toggle="tab" href="#edit"
		   role="tab" aria-controls="edit" aria-selected="true">Plugin Details</a>

		<a class="nav-link" id="listing-tab" data-bs-toggle="tab" href="#listing"
		   role="tab" aria-controls="listing" aria-selected="false">Plugin Listing Request</a>
	</div>
</nav>

<div class="tab-content" id="pluginTabsContent">
	<div class="tab-pane show active" id="edit" role="tabpanel" aria-labelledby="edit-tab">
		<div class="row">
			<div class="col-md-10 col-lg-8">
				@if (!string.IsNullOrEmpty(Model.Identifier))
				{
					<div class="mb-4">
						<strong>Identifier:</strong> <code>@Model.Identifier</code>
					</div>
				}
				@if (Model.PluginUsers?.Any() == true)
				{
					<div class="mb-5">
						<h5 class="fw-bold mb-3">Plugin Users</h5>
						@foreach (var user in Model.PluginUsers)
						{
							<div class="d-flex justify-content-between align-items-center border-bottom py-2">
								<div>
									<strong>@user.Email</strong>
									@if (user.IsPluginOwner)
									{
										<span class="badge bg-success ms-2">Owner</span>
									}
								</div>
								<form method="post"
									  asp-controller="Admin" asp-action="ManagePluginOwnership"
									  asp-route-pluginSlug="@Model.Slug" asp-route-userId="@user.UserId"
									  asp-route-command="@(user.IsPluginOwner ? "RevokeOwnership" : "AssignOwnership")" class="d-inline">
									@Html.AntiForgeryToken()
									<button type="submit"
											class="btn btn-sm @(user.IsPluginOwner ? "btn-outline-danger" : "btn-outline-primary")">
										@(user.IsPluginOwner ? "Revoke Ownership" : "Set as Owner")
									</button>
								</form>
							</div>
						}
					</div>
				}
				<form asp-action="PluginEdit" method="post">
					@Html.AntiForgeryToken()
					<div class="mb-3">
						<label class="form-label fw-semibold">Plugin Title</label>
						<input type="text" asp-for="PluginSettings.PluginTitle" class="form-control" placeholder="Enter plugin title" />
					</div>
					<div class="mb-3">
						<label class="form-label fw-semibold">Description</label>
						<textarea asp-for="PluginSettings.Description" class="form-control" rows="4" placeholder="Enter plugin description">@Model.PluginSettings?.Description</textarea>
					</div>
					<div class="mb-3">
						<label asp-for="Visibility" class="form-label"></label>
						<select asp-for="Visibility" class="form-select" asp-items="Html.GetEnumSelectList<PluginVisibilityEnum>()"></select>
						<span asp-validation-for="Visibility" class="text-danger"></span>
					</div>
					<div class="text-end mt-4">
						<input type="submit" class="btn btn-primary" value="Save Changes" />
					</div>
				</form>
			</div>
		</div>
	</div>


	<div class="tab-pane"
		 id="listing"
		 role="tabpanel"
		 aria-labelledby="listing-tab">
		<div class="col-md-10 col-lg-8">

			@if (Model.PluginSettings?.RequestListing == null)
			{
				<div class="col-12 text-center py-5">
					<p class="text-muted">No listing request has been submitted yet</p>
				</div>
			}
			else
			{
				<div class="mb-3 row">
					<label class="col-sm-3 col-form-label fw-semibold">Telegram Link</label>
					<div class="col-sm-9">
						<a href="@Model.PluginSettings.RequestListing.TelegramVerificationMessage" target="_blank" rel="noopener noreferrer" class="text-decoration-none">
							@Model.PluginSettings.RequestListing.TelegramVerificationMessage
						</a>
					</div>
				</div>

				<div class="mb-3 row">
					<label class="col-sm-3 col-form-label fw-semibold">User Reviews</label>
					<div class="col-sm-9">
						<p class="form-control-plaintext">@Model.PluginSettings.RequestListing.UserReviews</p>
					</div>
				</div>

				<div class="mb-3 row">
					<label class="col-sm-3 col-form-label fw-semibold">Release Description</label>
					<div class="col-sm-9">
						<p class="form-control-plaintext">@Model.PluginSettings.RequestListing.ReleaseNote</p>
					</div>
				</div>
			}
		</div>
	</div>
</div>
